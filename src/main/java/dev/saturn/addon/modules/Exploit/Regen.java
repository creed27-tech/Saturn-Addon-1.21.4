package dev.saturn.addon.modules.Exploit;

import dev.saturn.addon.Saturn;
import meteordevelopment.meteorclient.settings.IntSetting;
import meteordevelopment.meteorclient.settings.SettingGroup;
import meteordevelopment.orbit.EventHandler;
import net.minecraft.network.packet.c2s.play.PlayerMoveC2SPacket;
import org.lwjgl.glfw.GLFW;
import dev.saturn.addon.events.thunderhack.EventSync;
import meteordevelopment.meteorclient.systems.modules.Module;
import meteordevelopment.meteorclient.settings.Setting;

import static dev.saturn.addon.utils.antip2w.MCUtil.sendPacket;

public class Regen extends Module {
    private final SettingGroup sgGeneral = settings.getDefaultGroup();

    public Regen() {
        super(Saturn.Exploit, "Regen", "Allows you to regenerate health. | Ported from Thunderhack Recode");
    }

    private final Setting<Integer> health = sgGeneral.add(new IntSetting.Builder()
            .name("health")
            .description("Health threshold to trigger regeneration.")
            .defaultValue(10)
            .min(0)
            .max(20)
            .build()
    );

    private final Setting<Integer> packetsPerTick = sgGeneral.add(new IntSetting.Builder()
            .name("packets-per-tick")
            .description("Number of packets to send per tick.")
            .defaultValue(20)
            .min(2)
            .max(120)
            .build()
    );

    @EventHandler
    public void onSync(EventSync e) {
        if (mc.player != null && (mc.player.getHealth() + mc.player.getAbsorptionAmount() <= health.get())) {
            for (int i = 0; i < packetsPerTick.get(); i++) {
                sendPacket(new PlayerMoveC2SPacket.Full(
                        mc.player.getX(),
                        mc.player.getY(),
                        mc.player.getZ(),
                        mc.player.getYaw(),
                        mc.player.getPitch(),
                        mc.player.isOnGround(),
                        false // Adding the missing boolean argument for PlayerMoveC2SPacket.Full constructor
                ));
            }
        }
    }
}